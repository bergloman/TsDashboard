/*! tsdash 2016-11-25 */
function TsDashboard(a,b){this.driver=b,this.div_id=a,this.init(),this.regex_date=/^(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))$/,this.regex_datetime=/^(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31)) (0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}$/,this.driver.registerView&&this.driver.registerView(this)}function getFriendlyTimeSlotLabel(a){if(null!=a){for(var b=0,c=[{n:1e3,t:"sec"},{n:6e4,t:"min"},{n:36e5,t:"h"},{n:864e5,t:"day"}];b<c.length&&a/c[b].n>=1;)b++;return b--,b=Math.max(0,b),y_label="per "+a/c[b].n+" "+c[b].t,y_label}return null}function TsDashboardDummyDriver(a,b){this.view_definition=a,this.data=b,this.view_object=null}TsDashboard.prototype.onParamChange=function(a){self.driver.onParamChange&&self.driver.onParamChange(a)},TsDashboard.prototype.init=function(){var a=this;a.driver.getViewDefinition(function(b){a.conf=b,a.conf.parameters=a.conf.parameters||[],a.top=$("#"+a.div_id),a.top.addClass("tsd"),a.conf.hide_sidebar?a.top.append("<div class='tsd-main' id='tsd_main'></div>"):(a.top.append("<div class='tsd-sidebar dark-matter'></div>"),a.top.append("<div class='tsd-main' id='tsd_main'></div>"),a.conf.sidebar_width=a.conf.sidebar_width||190,$(".tsd-sidebar").width(a.conf.sidebar_width),$(".tsd-main").css("margin-left",+a.conf.sidebar_width+"px"),b.title&&$(".tsd-sidebar").append("<h1>"+b.title+"</h1>"),a.initParams()),$(".tsd-main").append("<div role='alert'' class='tsd-error alert alert-danger'>...</div>"),$(".tsd-main").append("<div class='tsd-main-content' id='tsd_main_content'></div>"),$(".tsd-main").append("<div class='modal' id='divModal' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>                <div class='modal-dialog'>                    <div class='modal-content'>                        <div class='modal-header'>                            <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>                            <h4 class='modal-title' id='myModalLabel'>                            <span data-bind='text: modal_title'></span>                            </h4>                        </div>                        <div class='modal-body'>                            <div id='divModalChart'></div>                        </div>                    </div>                </div>            </div>"),a.conf.hide_sidebar&&a.run()})},TsDashboard.prototype.getParamValue=function(a){return $("#in"+a).val()},TsDashboard.prototype.setParamValue=function(a,b){var c=this;for(var d in c.conf.parameters)(function(d){var e=c.conf.parameters[d];e.name==a&&("boolean"===e.type?(label.append("<input type='checkbox' id='cb"+e.name+"'></input>"),e.default&&$("#cb"+e.name).attr("checked","true")):$("#in"+e.name).val(b))})(d)},TsDashboard.prototype.resetErrorMsg=function(){$(".tsd-error").removeClass("tsd-error-visible")},TsDashboard.prototype.showErrorMsg=function(a){$(".tsd-error").text(a),$(".tsd-error").addClass("tsd-error-visible")},TsDashboard.prototype.getToday=function(){return moment({hour:0}).toDate()},TsDashboard.prototype.getTimeString=function(a){return a||(a=new Date),moment(a).format("YYYY-MM-DD hh:mm:ss")},TsDashboard.prototype.getDateString=function(a){return a||(a=new Date),moment(a).format("YYYY-MM-DD")},TsDashboard.prototype.initParams=function(){for(var a=this,b=$(".tsd-sidebar"),c=0;c<a.conf.parameters.length;c++)(function(c){var d=a.conf.parameters[c],e=$(document.createElement("div"));e.appendTo(b),e.addClass("tsd-sidebar-param"),e.append("<span>"+d.title+"</span>"),"string"===d.type?(e.append("<input id='in"+d.name+"'></input>"),d.default&&$("#in"+d.name).val(d.default)):"datetime"===d.type?(e.append("<input id='in"+d.name+"' placeholder='yyyy-mm-dd hh:MM:ss'></input>"),$("#in"+d.name).blur(function(){var b=$("#in"+d.name).val();a.regex_date.test(b)&&$("#in"+d.name).val(b+" 00:00:00")}),e.append("<a id='hin_now_"+d.name+"' class='tsd-input-help'>Now</a> "),$("#hin_now_"+d.name).click(function(){$("#in"+d.name).val(a.getTimeString())}),e.append("<a id='hin_today_"+d.name+"' class='tsd-input-help'>Today</a> "),$("#hin_today_"+d.name).click(function(){$("#in"+d.name).val(a.getDateString()+" 00:00:00")}),d.default&&(d.default instanceof Date?$("#in"+d.name).val(a.getTimeString(d.default)):"$now"==d.default?$("#in"+d.name).val(a.getTimeString()):"$today"==d.default?$("#in"+d.name).val(a.getDateString()+" 00:00:00"):$("#in"+d.name).val(d.default))):"date"===d.type?(e.append("<input id='in"+d.name+"' placeholder='yyyy-mm-dd'></input>"),e.append("<a id='hin_today_"+d.name+"' class='tsd-input-help'>Today</a> "),$("#hin_today_"+d.name).click(function(){$("#in"+d.name).val(a.getDateString())}),d.default&&(d.default instanceof Date?$("#in"+d.name).val(a.getDateString(d.default)):"$now"==d.default?$("#in"+d.name).val(a.getDateString()):"$today"==d.default?$("#in"+d.name).val(a.getDateString()):$("#in"+d.name).val(d.default))):"filter"===d.type?(e.append("<input id='in"+d.name+"'></input>"),e.append("<div id='opt"+d.name+"' class='tsd-match-options'></div>"),$("#in"+d.name).keyup(function(){var b=$("#in"+d.name).val(),c=void 0===d.search_min_len&&b.length<3||void 0!==d.search_min_len&&b.length<d.search_min_len;c||a.driver.getParamValues(d.name,b,function(a){$("#opt"+d.name).empty(),$("#opt"+d.name).show();for(var b=0;b<a.length;b++)(function(b){var c=$(document.createElement("div"));c.text(a[b]),c.click(function(){$("#in"+d.name).val(a[b]),$("#opt"+d.name).empty(),$("#opt"+d.name).hide()}),$("#opt"+d.name).append(c)})(b)})}),d.default&&$("#in"+d.name).val(d.default)):"enum"===d.type?(e.append("<select id='in"+d.name+"'></select >"),a.driver.getParamValues(d.name,null,function(a){for(var b=0;b<a.length;b++){var c=a[b];$("#in"+d.name).append("<option value='"+c.value+"'>"+c.caption+"</option>")}d.default&&$("#in"+d.name).val(d.default)})):"boolean"===d.type&&(e.append("<input type='checkbox' id='in"+d.name+"'></input>"),d.default&&$("#in"+d.name).attr("checked","true")),$("#in"+d.name).change(function(){a.onParamChange(d.name)})})(c);var d=$(document.createElement("button"));d.text("Run"),d.click(function(){a.run()}),d.appendTo(b)},TsDashboard.prototype.collectParameterValues=function(){var a=this,b=[];for(var c in a.conf.parameters){var d=a.conf.parameters[c],e={name:d.name};if("string"===d.type){if(e.value=$("#in"+d.name).val().trim(),!d.optional&&""===e.value)return a.showErrorMsg("Missing non-optional parameter: "+d.title),null}else if("datetime"===d.type){if(e.value=$("#in"+d.name).val(),!d.optional&&null===e.value)return a.showErrorMsg("Missing non-optional parameter: "+d.title),null;if(!a.regex_datetime.test(e.value)){if(!a.regex_date.test(e.value))return a.showErrorMsg("Invalid date format or value: "+d.title),null;e.value+=" 00:00:00"}e.value=moment(e.value,"YYYY-MM-DD HH:mm:ss").toDate()}else if("date"===d.type){if(e.value=$("#in"+d.name).val(),!d.optional&&null===e.value)return a.showErrorMsg("Missing non-optional parameter: "+d.title),null;if(!a.regex_date.test(e.value))return a.showErrorMsg("Invalid date format or value: "+d.title),null;e.value=moment(e.value,"YYYY-MM-DD").toDate()}else if("filter"===d.type){if(e.value=$("#in"+d.name).val(),!d.optional&&null===e.value)return a.showErrorMsg("Missing non-optional parameter: "+d.title),null}else if("enum"===d.type){if(e.value=$("#sel"+d.name).val(),!d.optional&&null===e.value)return a.showErrorMsg("Missing non-optional parameter: "+d.title),null}else"boolean"===d.type&&(e.value=!1,$("#cb"+d.name).attr("checked")&&(e.value=!0));b.push(e)}return b},TsDashboard.prototype.run=function(){var a=this,b=$("#tsd_main_content");b.empty(),a.resetErrorMsg();var c=a.collectParameterValues();if(c){var d={conf:a.conf,params:c};a.driver.getDrawData(d,function(c){var d=1;for(var e in a.conf.blocks){var f=a.conf.blocks[e],g=$(document.createElement("div"));b.append(g),g.addClass("tsd-block"),f.title&&f.title.length>0&&g.append($(document.createElement("h2")).text(f.title));var h=$(document.createElement("div"));h.addClass("tsd-block-inner"),g.append(h);var i="tsd-col-1-"+f.panels.length;for(var j in f.panels){var k=f.panels[j],l=$(document.createElement("div"));h.append(l),l.addClass("tsd-panel"),l.addClass(i),k.title&&k.title.length>0&&l.append($(document.createElement("h3")).text(k.title));for(var m in k.widgets){var n=k.widgets[m];n.type=n.type||"timeseries",n.timepoints=n.timepoints||[];var o=$(document.createElement("div"));l.append(o),o.addClass("tsd-widget"),n.title&&n.title.length>0&&o.append($(document.createElement("h3")).text(n.title));var p="tsd_widget_"+d;if(o.append($(document.createElement("div")).attr("id",p).attr("class","tsd-widget-sub")),"timeseries"==n.type){var q=[];q=n.timeseries.map(function(a){for(var b in c.timeseries){var d=c.timeseries[b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var r=[];r=n.timepoints.map(function(a){for(var b in c.timepoints){var d=c.timepoints[b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var s={chart_div:"#"+p,data:q,timepoints:r,xdomain:c.timeseries[0].xdomain,height:n.height,handle_clicks:!0,y_axis_label:getFriendlyTimeSlotLabel(c.timeseries[0].slot_length)};s.click_callback=function(b){return function(){a.showModal(b)}}(s),n.options&&Object.assign(s,n.options),a.drawTimeSeriesMulti(s)}else if("histogram"==n.type){var q=[];q=n.dataseries.map(function(a){for(var b in c.dataseries){var d=c.dataseries[b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var s={chart_div:"#"+p,data:q[0],xdomain:c.dataseries[0].xdomain,height:n.height,handle_clicks:!0};s.click_callback=function(b){return function(){a.showModalColumnChart(b)}}(s),n.options&&Object.assign(s,n.options),a.drawColumnChart(s)}else if("scatterplot"==n.type){var q=[];q=n.scatterseries.map(function(a){for(var b in c.scatterseries){var d=c.scatterseries[b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var s={chart_div:"#"+p,data:q[0],height:n.height,handle_clicks:!0};s.click_callback=function(b){return function(){a.showModalScatterPlot(b)}}(s),n.options&&Object.assign(s,n.options),a.drawScatterPlot(s)}else if("table"==n.type){var q=[],t="dataseries";n.timeseries&&(t="timeseries"),q=n[t].map(function(a){for(var b in c[t]){var d=c[t][b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var s={chart_div:"#"+p,data:q,height:n.height,handle_clicks:!1};s.click_callback=function(b){return function(){a.showModal(b)}}(s),n.options&&Object.assign(s,n.options),a.drawTable(s)}else if("kpi"==n.type){var q=n.dataseries.map(function(a){for(var b in c.dataseries){var d=c.dataseries[b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a}),s={kpi_div:"#"+p,data:q[0],height:n.height,handle_clicks:!1};n.options&&Object.assign(s,n.options),a.drawKpi(s)}else if("graph"==n.type){var u={},t="graphs";u=n[t].map(function(a){for(var b in c[t]){var d=c[t][b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var s={chart_div:"#"+p,data:u,handle_clicks:!1};n.options&&Object.assign(s,n.options),a.drawTemporalGraph(s)}else if("swimlane"==n.type){console.log(n);var q=[];q=n.dataseries.map(function(a){for(var b in c.dataseries){var d=c.dataseries[b];if(d.name===a)return d.values}return null}).filter(function(a){return null!==a});var s={chart_div:"#"+p,data:q,handle_clicks:!1};n.options&&Object.assign(s,n.options),a.drawSwimlaneChart(s)}d++}}}})}},TsDashboard.prototype.showModal=function(a){var b=this;$("#divModal").on("shown.bs.modal",function(c){a.chart_div="#divModalChart",a.height=800,a.handle_clicks=!0,a.click_callback=function(){},b.drawTimeSeriesMulti(a)}),$("#divModal").modal()},TsDashboard.prototype.showModalColumnChart=function(a){var b=this;$("#divModal").on("shown.bs.modal",function(c){a.chart_div="#divModalChart",a.height=500,a.handle_clicks=!1,a.click_callback=function(){},b.drawColumnChart(a)}),$("#divModal").modal()},TsDashboard.prototype.showModalScatterPlot=function(a){var b=this;$("#divModal").on("shown.bs.modal",function(c){a.chart_div="#divModalChart",a.height=500,a.handle_clicks=!1,a.click_callback=function(){},b.drawScatterPlot(a)}),$("#divModal").modal()},TsDashboard.prototype.toNiceDateTime=function(a){return a?moment(a).format("YYYY-MM-DD HH:mm:ss"):"-"},TsDashboard.prototype.drawTimeSeriesMulti=function(a){var b=this,c={chart_div:"#someChart",data:null,height:100,xaccessor:function(a){return a.epoch},yaccessor:function(a){return a.val},xdomain:null,xdomain_min:null,xdomain_max:null,ydomain:null,ydomain_min:null,ydomain_max:null,xcaption:null,ycaptions:null,series_style_indices:null,handle_clicks:!1,show_grid:!0,x_axis_label:null,y_axis_label:null,graph_css:"area",xAxisFontSize:"14px",yAxisFontSize:"14px",xAxisTicks:7,yFormatValue:"s",tickNumber:function(a,b){return Math.min(a<100?3:8,b)},markerStroke:3,markerOpacity:.4,markerOpacityHover:.8,markerColor:"#ff0000",click_callback:null,timepoints:null,timepoint_callback:null};if("undefined"!==a)for(var d in a)c[d]=a[d];if(!c.xdomain){var e=c.data.map(function(a){return d3.extent(a,c.xaccessor)}),f=[];e.forEach(function(a){f=f.concat(a)}),c.xdomain=d3.extent(f)}if(!c.ydomain){var e=c.data.map(function(a){return d3.extent(a,c.yaccessor)}),f=[];e.forEach(function(a){f=f.concat(a)}),c.ydomain=d3.extent(f)}null!==c.xdomain_min&&(c.xdomain[0]=c.xdomain_min),null!==c.xdomain_max&&(c.xdomain[1]=c.xdomain_max),null!==c.ydomain_min&&(c.ydomain[0]=c.ydomain_min),null!==c.ydomain_max&&(c.ydomain[1]=c.ydomain_max);var h=0;if(c.data.forEach(function(a){h+=a.length}),!c.series_style_indices){c.series_style_indices=[];for(var i=0;i<c.data.length;i++)c.series_style_indices.push(i)}$(c.chart_div).empty();var j={top:18,right:35,bottom:20,left:50};c.x_axis_label&&(j.bottom+=20);var k=$(c.chart_div).width()-j.left-j.right,l=c.height-j.top-j.bottom,m=(d3.time.format("%d-%b-%y").parse,d3.time.scale().domain(c.xdomain).range([0,k])),n=d3.scale.linear().domain(c.ydomain).range([l,0]),o=((m.domain()[1].getTime()-m.domain()[0].getTime())/1e3/60,d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],["%d %b",function(a){return a.getDay()&&1!=a.getDate()}],["%d %b",function(a){return 1!=a.getDate()}],["%d %b",function(a){return a.getMonth()}],["%d %b %Y",function(){return!0}]])),p=d3.svg.axis().scale(m).orient("bottom").ticks(c.xAxisTicks).tickFormat(o);c.show_grid&&p.innerTickSize(-l).outerTickSize(0).tickPadding(10);var q=d3.format(c.yFormatValue),r=c.tickNumber(l,c.ydomain[1]),s=d3.svg.axis().scale(n).orient("left").ticks(r).tickFormat(function(a){return q(a)});c.show_grid&&s.innerTickSize(-k).outerTickSize(0).tickPadding(10);for(var t=d3.svg.line().x(function(a){return m(c.xaccessor(a))}).y(function(a){return n(c.yaccessor(a))}),u=d3.select(c.chart_div).append("svg").attr("width",k+j.left+j.right).attr("height",l+j.top+j.bottom).append("g").attr("transform","translate("+j.left+","+j.top+")"),i=0;i<c.data.length;i++){var v=c.data[i];u.append("path").attr("class","series series"+c.series_style_indices[i]).attr("d",t(v))}u.append("g").attr("class","x axis").attr("transform","translate(0, "+l+")").style("font-size",c.xAxisFontSize).call(p),g=u.append("g").attr("class","y axis").style("font-size",c.yAxisFontSize).call(s),null!=c.x_axis_label&&u.append("text").attr("class","x label").attr("text-anchor","end").attr("x",k-10).attr("y",l+j.top+16).text(c.x_axis_label),null!=c.y_axis_label&&u.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text(c.y_axis_label);var w=d3.select(c.chart_div).append("div").attr("class","line-chart-tooltip").attr("id",c.chart_div+"_tooltip").style("opacity",0);if(c.handle_clicks){var x=function(a){var b=d3.mouse(a),d=m.invert(b[0]),e=d3.bisector(c.xaccessor).left,f=e(c.data[0],d),g=c.data[0][f-1],h=c.data[0][f];return 0==f&&(g=h),f>=c.data[0].length&&(h=g),d.getTime()-c.xaccessor(g)>c.xaccessor(h)-d.getTime()?h:g};g.on("click",function(){if(c.click_callback){var a=x(this);c.click_callback(a.epoch)}});var y=g.append("g").style("display","none");y.append("line").attr("id","focusLineX").attr("class","focusLine").style("stroke-dasharray","5, 3"),y.append("line").attr("id","focusLineY").attr("class","focusLine").style("stroke-dasharray","5, 3"),y.append("circle").attr("id","focusCircle").attr("r",5).attr("class","circle focusCircle"),g.append("rect").attr("class","overlay").attr("width",k).attr("height",l).on("mouseover",function(){y.style("display",null)}).on("mouseout",function(){y.style("display","none"),w.style("opacity",0)}).on("mousemove",function(){var a=x(this),d=m(new Date(c.xaccessor(a))),e=n(c.yaccessor(a));y.style("display",null),w.style("opacity",.8),w.html(c.yaccessor(a).toFixed(4)+"<br/>"+b.toNiceDateTime(c.xaccessor(a))).style("left",d-10+"px").style("top",e+40+"px"),y.select("#focusCircle").attr("cx",d).attr("cy",e),y.select("#focusLineX").attr("x1",d).attr("y1",n(n.domain()[0])).attr("x2",d).attr("y2",n(n.domain()[1])),y.select("#focusLineY").attr("x1",m(m.domain()[0])).attr("y1",e).attr("x2",m(m.domain()[1])).attr("y2",e)})}if(c.timepoints&&c.timepoints.length>0)for(var z=0;z<c.timepoints.length;z++)for(var A=c.timepoints[z],i=0;i<A.length;i++){var B=A[i],C=B.title,D=B.epoch,E=b.toNiceDateTime(B.epoch),F=m(D);c.markerColor;!isNaN(F)&&F>0&&u.append("a").append("line").attr("id",F).attr("data:ts",E).attr("data:tt-title",C).attr("x1",F).attr("x2",F).attr("y1",0).attr("y2",c.height-j.top-j.bottom).attr("class","series"+z).style("stroke-width",c.markerStroke).style("opacity",c.markerOpacity).on("mouseover",function(a){var b=d3.select(this)[0][0].id,d=d3.select(this)[0][0].attributes[1].value,e=d3.select(this)[0][0].attributes[2].value;d3.select(this).style("opacity",1),w.style("opacity",c.markerOpacityHover),w.html(e+"<br/>"+d).style("left",b-70+"px").style("bottom",l+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",c.markerOpacity),w.style("opacity",0)})}h<=0&&g.append("text").attr("x",k/2).attr("y",l/2).attr("dy","1em").attr("text-anchor","end").text("NO DATA!").attr("class","zerolinetext")},TsDashboard.prototype.drawTable=function(a){var b={chart_div:"#someChart",data:null,header:null,height:400,margin_bottom:60,column_widths:null,column_order:null,columns:null};if("undefined"!==a)for(var c in a)b[c]=a[c];$(b.chart_div).empty();var d=b.data[0],e=b.columns;if(!e){e=[];for(var f in d[0])e.push({source:f})}for(var g=$("<thead></thead>"),h=$("<tr></tr>"),i=0;i<e.length;i++)e[i].caption?h.append("<th>"+e[i].caption+"</th>"):h.append("<th>"+e[i].source+"</th>");for(var j=$("<tbody></tbody>"),i=0;i<d.length;i++){for(var k=$("<tr></tr>"),l=0;l<e.length;l++){var m=$("<td>"+d[i][e[l].source]+"</td>");e[l].width&&m.css("width",e[l].width),k.append(m)}j.append(k)}var n=$('<table class="table"></div>');g.append(h),n.append(g),n.append(j),$(b.chart_div).append(n),$(b.chart_div).css("overflow","auto"),$(b.chart_div).css("height",b.height),$(b.chart_div).css("margin-bottom",b.margin_bottom)},TsDashboard.prototype.drawKpi=function(a){var b={kpi_div:"#someKpi",data:null,header:null,height:100,margin_bottom:0,column_widths:null,column_order:null,filter:null};if("undefined"!==a)for(var c in a)b[c]=a[c];$(b.kpi_div).empty();for(var d=b.data,e=$("<tbody></tbody>"),f=$("<tr></tr>"),g=0;g<d.length;g++){var h=d[g],i=$("<td class='tsd-kpi-tile tsd-kpi-tile-ok' />");switch(h.status){case"ok":i.addClass("tsd-kpi-tile-ok");break;case"error":i.addClass("tsd-kpi-tile-error");break;case"warning":i.addClass("tsd-kpi-tile-warning");break;default:i.addClass("tsd-kpi-tile-inactive")}i.append("<div class='tsd-kpi-tile-title'></div>").text(h.name),i.append("<div class='tsd-kpi-tile-value'></div>").text(h.value),f.append(i)}e.append(f);var j=$("<table></table>");j.append(e),$(b.kpi_div).append(j)},TsDashboard.prototype.drawTemporalGraph=function(a){var b={chart_div:"#someChart",data:null,height:400,min_node_size:2,max_node_size:4,min_edge_size:2,max_edge_size:6,node_color:"red",edge_color:"blue",node_opacity:.3,node_stroke:"red",default_node_size:1,default_edge_size:2,side_margin:20,duration:0,unselected_opacity:.1,x_pos_att:"epoch"};if("undefined"!==a)for(var c in a)console.log(c,a[c]),b[c]=a[c];console.log(e),console.log(b),$(b.chart_div).empty(),$(b.chart_div).css("height",b.height);var d=d3.select(b.chart_div).append("svg").attr("x",0).attr("y",0).attr("width",$(b.chart_div).width()).attr("height",b.height),e=b.data[0],f=e.nodes,g=e.edges,h=b.x_pos_att,i=[],j=[],k=[],l=[],m=[],n=[];for(var o in f)i.push(f[o][h]),j.push(f[o].y),k.push(f[o].epoch),m.push(f[o].size),l.push({id:o,options:f[o]});for(var p=0;p<g.length;p++)n.push(g[p].size);var q=d3.scale.linear().domain([d3.min(i),d3.max(i)]).range([b.side_margin,$(b.chart_div).width()-b.side_margin]),r=d3.scale.linear().domain([d3.min(j),d3.max(j)]).range([b.side_margin,$(b.chart_div).height()-b.side_margin]),s=d3.scale.linear().domain([d3.min(m),d3.max(m)]).range([b.min_node_size,b.max_node_size]),t=d3.scale.linear().domain([d3.min(n),d3.max(n)]).range([b.min_edge_size,b.max_edge_size]),u=d.selectAll("lines").data(g);u.enter().append("path").attr("d",function(a){var b=q(f[a.n1][h]),c=q(f[a.n2][h]),d=r(f[a.n1].y),e=r(f[a.n2].y),g=parseInt(b)+parseInt((c-b)/2);return"M"+b+","+d+"C"+g+","+d+" "+g+","+e+" "+c+","+e}).transition().delay(function(a){return b.duration*(1-(d3.max(k)-f[a.n2].epoch)/(d3.max(k)-d3.min(k)))}).style("fill","none").style("stroke",function(a){return a.color?a.color:b.edge_color}).style("stroke-width",function(a){return a.size?t(a.size):b.default_edge_size}).style("stroke-opacity",function(a){return a.node_opacity?a.node_opacity:b.node_opacity}),d.selectAll("path").append("svg:title").text(function(a){return a.n1+"-"+a.n2});var v=d.selectAll("circles").data(l);v.enter().append("circle").transition().delay(function(a){return b.duration*(1-(d3.max(k)-a.options.epoch)/(d3.max(k)-d3.min(k)))}).attr("r",function(a){return a.options.size?s(a.options.size):b.default_node_size}).attr("cx",function(a){return q(a.options[h])}).attr("cy",function(a){return r(a.options.y)}).attr("fill","white").attr("fill-opacity",b.node_opacity).attr("stroke",b.node_stroke),d.selectAll("circle").append("svg:title").text(function(a){return a.id+"\n"+a.options.epoch}),d.selectAll("circle").on("mouseover",function(a,c){d.selectAll("path").style("stroke-opacity",function(c){return a.id!=c.n1&&a.id!=c.n2?b.unselected_opacity:b.node_opacity})}).on("mouseout",function(a,c){d.selectAll("path").style("stroke-opacity",b.node_opacity)}),d.selectAll("path").on("mouseover",function(a,c){d.selectAll("path").style("stroke-opacity",function(c){return a.n1==c.n1&&a.n2==c.n2||a.n1==c.n1&&a.n1==c.n2?b.selected_opacity:b.unselected_opacity})}).on("mouseout",function(a,c){d.selectAll("path").style("stroke-opacity",b.node_opacity)})},TsDashboard.prototype.drawSwimlaneChart=function(a){function b(){for(var a=0;a<h.length;a++)n?o[h[a]].attr("display","none"):o[h[a]].attr("display","inline");n=!n,$(c.chart_div).css("width","100%")}var c={start:1476704004295,end:1476704005295,side_margin:10,chart_div:"#divTarget",alert_color:"white",lanes_color:"#444",master_lane_color:"#444",lane_opacity:.4,lane_selected_opacity:.8,lane_height:20,alert_radius:5,alert_over_radius:10,ticks:10};if("undefined"!==a)for(var d in a)c[d]=a[d];console.log(c);var e=c.data[0],f=e.alerts;e.start,e.end;$(c.chart_div).empty();for(var f=[{type:"db",ts:1476704004495},{type:"events",ts:1476704004535},{type:"events",ts:1476704004695},{type:"blalalalaaaa",ts:1476704004995}],g=d3.scale.linear().domain([c.start,c.end]).range([c.side_margin,$(c.chart_div).width()-c.side_margin]),h=[],i={},j=0;j<f.length;j++)f[j].type in i?i[f[j].type]+=1:i[f[j].type]=1;for(var k in i)h.push(k);var l=d3.select(c.chart_div).append("svg").attr("width",$(c.chart_div).width()).attr("height",c.lane_height),m=l.append("rect").attr("x",0).attr("y",0).attr("width",$(c.chart_div).width()).attr("height",c.lane_height).attr("fill",c.master_lane_color).attr("fill-opacity",c.lane_opacity).on("mouseover",function(a){d3.select(this).attr("fill-opacity",c.lane_selected_opacity)}).on("mouseout",function(a){d3.select(this).attr("fill-opacity",c.lane_opacity)});l.selectAll("circle").data(f).enter().append("circle").attr("cy",c.lane_height/2).attr("cx",function(a){return g(a.ts)}).attr("r",c.alert_radius).attr("fill",c.alert_color).on("mouseover",function(a){d3.select(this).attr("r",c.alert_over_radius)}).on("mouseout",function(a){d3.select(this).attr("r",c.alert_radius)}).append("svg:title").text(function(a,b){return"My type is: "+a.type}),m.on("click",function(){b(),d3.event.stopPropagation()});for(var n=!0,o={},j=0;j<h.length;j++)o[h[j]]=d3.select(c.chart_div).append("svg").attr("width",$(c.chart_div).width()).attr("height",c.lane_height),o[h[j]].append("rect").attr("x",0).attr("y",0).attr("width",$(c.chart_div).width()).attr("height",c.lane_height).attr("fill",c.lanes_color).attr("fill-opacity",c.lane_opacity).on("mouseover",function(a){d3.select(this).attr("fill-opacity",c.lane_selected_opacity)}).on("mouseout",function(a){d3.select(this).attr("fill-opacity",c.lane_opacity)}).append("svg:title").text(function(a){return h[j]});for(var j=0;j<h.length;j++)o[h[j]].selectAll("circle").data(f.filter(function(a){return a.type==h[j]})).enter().append("circle").attr("cy",c.lane_height/2).attr("cx",function(a){return g(a.ts)}).attr("r",c.alert_radius).attr("fill",c.alert_color).on("mouseover",function(a){d3.select(this).attr("r",c.alert_over_radius)}).on("mouseout",function(a){d3.select(this).attr("r",c.alert_radius)}).append("svg:title").text(function(a,b){return"My type is: "+a.type});var p=d3.time.scale().domain([new Date(c.start),new Date(c.end)]).nice(d3.time.hour).range([0,$(c.chart_div).width()]),q=d3.select(c.chart_div).append("svg").attr("width",$(c.chart_div).width()).attr("height",c.lane_height);q.append("g").attr("class","x axis").call(d3.svg.axis().scale(p).orient("bottom").ticks(c.ticks)).style("stroke","none")},TsDashboard.prototype.drawColumnChart=function(a){var b={chart_div:"#someChart",data:null,height:400,margin_bottom:60,xaccessor:function(a){return a.name},yaccessor:function(a){return a.val},xdomain:null,xdomain_min:null,xdomain_max:null,ydomain:null,ydomain_min:null,ydomain_max:null,xcaption:null,ycaptions:null,series_style_indices:null,handle_clicks:!1,show_grid:!0,x_axis_label:null,y_axis_label:null,graph_css:"area",xAxisFontSize:"14px",yAxisFontSize:"14px",xAxisTicks:7,yFormatValue:"s",tickNumber:function(a,b){return Math.min(a<100?3:8,b)},markerStroke:3,markerOpacity:.4,markerOpacityHover:.8,markerColor:"#ff0000",click_callback:null,timepoints:null,timepoint_callback:null};if("undefined"!==a)for(var c in a)b[c]=a[c];$(b.chart_div).empty();var d={top:18,right:35,bottom:b.margin_bottom,left:50};b.x_axis_label&&(d.bottom+=20);var e=$(b.chart_div).width()-d.left-d.right,f=b.height-d.top-d.bottom,h=d3.scale.ordinal().rangeRoundBands([0,e],.1),i=d3.scale.linear().range([f,0]),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left"),l=d3.select(b.chart_div).append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),m=b.data;h.domain(m.map(b.xaccessor)),i.domain([0,d3.max(m,b.yaccessor)]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)"),l.append("g").attr("class","y axis").call(k),null!=b.x_axis_label&&l.append("text").attr("class","x label").attr("text-anchor","end").attr("x",e-10).attr("y",f+d.top+16).text(b.x_axis_label),null!=b.y_axis_label&&l.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text(b.y_axis_label),l.selectAll(".bar").data(m).enter().append("rect").attr("class","tsd-bar").attr("x",function(a){return h(b.xaccessor(a))}).attr("y",function(a){return i(b.yaccessor(a))}).attr("height",function(a){return f-i(b.yaccessor(a))}).attr("width",h.rangeBand()).on("mouseover",function(){d3.select(this).classed("tsd-bar-highlight",!0),n.style("display",null)}).on("mouseout",function(){d3.select(this).classed("tsd-bar-highlight",!1),n.style("display","none")}).on("mousemove",function(a){var c=d3.mouse(this)[0]-15,d=d3.mouse(this)[1]-25;n.attr("transform","translate("+c+","+d+")"),n.select("text").text(b.yaccessor(a))});var n=l.append("g").attr("class","tsd-tooltip").style("display","none");n.append("rect").attr("width",30).attr("height",20),n.append("text").attr("x",15).attr("dy","1.2em").style("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold"),b.handle_clicks&&l.on("click",function(){b.click_callback&&b.click_callback()}),m.length<=0&&g.append("text").attr("x",e/2).attr("y",f/2).attr("dy","1em").attr("text-anchor","end").text("NO DATA!").attr("class","zerolinetext")},TsDashboard.prototype.drawScatterPlot=function(a){var b={chart_div:"#someChart",data:null,height:400,xaccessor:function(a){return a.x},yaccessor:function(a){return a.y},caccessor:function(a){return a.c||""},xdomain:null,xdomain_min:null,xdomain_max:null,ydomain:null,ydomain_min:null,ydomain_max:null,ycaptions:null,handle_clicks:!1,show_grid:!0,x_axis_label:null,y_axis_label:null,graph_css:"area",xAxisFontSize:"14px",yAxisFontSize:"14px",xAxisTicks:7,yFormatValue:"s",tickNumber:function(a,b){return Math.min(a<100?3:8,b)},markerStroke:3,markerOpacity:.4,markerOpacityHover:.8,markerColor:"#ff0000",click_callback:null};if("undefined"!==a)for(var c in a)b[c]=a[c];$(b.chart_div).empty();var d={top:18,right:35,bottom:30,left:50},e=$(b.chart_div).width()-d.left-d.right,f=b.height-d.top-d.bottom,h=b.xaccessor,i=d3.scale.linear().range([0,e]),j=function(a){return i(h(a))},k=d3.svg.axis().scale(i).orient("bottom"),l=b.yaccessor,m=d3.scale.linear().range([f,0]),n=function(a){return m(l(a))},o=d3.svg.axis().scale(m).orient("left"),p=b.caccessor,q=d3.scale.category10(),r=d3.select(b.chart_div).append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),s=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),t=b.data;if(i.domain([d3.min(t,h),d3.max(t,h)]),m.domain([d3.min(t,l),d3.max(t,l)]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(k).append("text").attr("class","label").attr("x",e).attr("y",-6).style("text-anchor","end").text(b.x_axis_label),r.append("g").attr("class","y axis").call(o).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(b.y_axis_label),r.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",j).attr("cy",n).style("fill",function(a){return q(p(a))}).on("mouseover",function(a){s.transition().duration(200).style("opacity",.9),s.html(p(a)+"<br/> ("+h(a)+", "+l(a)+")").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){s.transition().duration(500).style("opacity",0)}),q.domain.length>1){var u=r.selectAll(".legend").data(q.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});u.append("rect").attr("x",e-18).attr("width",18).attr("height",18).style("fill",q),u.append("text").attr("x",e-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a})}t.length<=0&&g.append("text").attr("x",e/2).attr("y",f/2).attr("dy","1em").attr("text-anchor","end").text("NO DATA!").attr("class","zerolinetext");
},TsDashboardDummyDriver.prototype.getParamValues=function(a,b,c){},TsDashboardDummyDriver.prototype.onParamChange=function(a){},TsDashboardDummyDriver.prototype.registerView=function(a){this.view_object=a},TsDashboardDummyDriver.prototype.getViewDefinition=function(a){a(this.view_definition)},TsDashboardDummyDriver.prototype.getDrawData=function(a,b){b(this.data)};