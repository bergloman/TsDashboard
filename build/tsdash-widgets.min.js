/*! tsdash */

var TsDashboard=TsDashboard||{};TsDashboard.Widgets=TsDashboard.Widgets||{},TsDashboard.Widgets.WidgetSwimLanes=function(a){var b=this,c={start:null,end:null,events:null,target_div:"#divTarget",type_field:"type",side_margin:0,left_padding:30,hide_types:!1,circle_color:"#007ACC",circle_color_cb:null,circle_color2:null,circle_color2_cb:null,lanes_color:"#303030",lane_color:"#000000",lane_color2:"#111",lane_opacity:1,lane_selected_opacity:1,lane_height:30,circle_radius:8,circle_over_radius:10,ticks:10,type_text_opacity:.3,click_cb:function(){},title_cb:function(a){return b.getTimeString(a.ts)}};if("undefined"!==a)for(var d in a)c[d]=a[d];c.circle_color=c.circle_color_cb||c.circle_color,c.circle_color2=c.circle_color2_cb||c.circle_color2||c.circle_color,c.target_div.startsWith("#")||(c.target_div="#"+c.target_div),c.hide_types&&(c.left_padding=0),this._p=c,this._sort_type="d",this.clear()},TsDashboard.Widgets.WidgetSwimLanes.prototype.clear=function(a){this._eventTypes=[],this._eventTypesDict={},this.analyzeEventTypes()},TsDashboard.Widgets.WidgetSwimLanes.prototype.redraw=function(a){this.clear(),this.draw()},TsDashboard.Widgets.WidgetSwimLanes.prototype.getTimeString=function(a){return a||(a=new Date),moment(a).format("YYYY-MM-DD hh:mm:ss")},TsDashboard.Widgets.WidgetSwimLanes.prototype.getEventType=function(a){return a[this._p.type_field]},TsDashboard.Widgets.WidgetSwimLanes.prototype.analyzeEventTypes=function(){for(var a=this,b=(this._p,this._p.events),c=this._eventTypes,d=this._eventTypesDict,e=0;e<b.length;e++){var f=b[e],g=this.getEventType(f);if(g in d){var h=d[g];c[h].max=f.ts,c[h].cnt++}else d[g]=c.length,c.push({type:g,min:f.ts,max:f.ts,cnt:1})}c.sort(function(b,c){return"d"==a._sort_type?b.min<c.min?-1:1:"c"==a._sort_type?b.cnt<c.cnt?1:-1:b.type.localeCompare(c.type)});for(var e=0;e<c.length;e++)d[c[e].type]=e},TsDashboard.Widgets.WidgetSwimLanes.prototype.draw=function(){var a=this,b=this._p,c=$(b.target_div).width(),d=b.events,e=b.start||d[0].ts,f=b.end||d[d.length-1].ts,g=f-e;e-=.05*g,f+=.05*g,$(b.target_div).empty().css("padding",b.side_margin).css("font-size",10).css("background-color",b.lanes_color);var h=[2*b.side_margin+b.left_padding,c-2*b.side_margin],i=d3.scale.linear().domain([e,f]).range(h),j=this._eventTypes,k=this._eventTypesDict,l=d3.select(b.target_div).append("svg").attr("width",c).attr("height",b.lane_height*j.length+40),m=d3.time.scale().domain([new Date(e),new Date(f)]).range(h);l.append("g").attr("transform","translate(0,20)").attr("class","axis").call(d3.svg.axis().scale(m).orient("top").ticks(b.ticks).innerTickSize(5).outerTickSize(1)).style("fill",b.circle_color).style("stroke","none");var n=l.append("g").selectAll(".timeline-lane").data(j).enter().append("g").attr("transform",function(a,c){return"translate(0,"+(20+c*b.lane_height)+")"}),o=0;if(n.append("rect").attr("class","timeline-lane").attr("x",0).attr("y",0).attr("width",c).attr("height",b.lane_height).attr("fill",function(){return o++%2==0?b.lane_color:b.lane_color2}),n.append("text").attr("class","timeline-lane-title").attr("x",5).attr("dy","1.5em").attr("opacity",b.type_text_opacity).text(function(a,b){return a.type||""}),l.selectAll("circle").data(d).enter().append("circle").attr("cy",function(c){return 20+(.5+k[a.getEventType(c)])*b.lane_height}).attr("cx",function(a){return i(a.ts)}).attr("r",b.circle_radius_cb||b.circle_radius).attr("fill",b.circle_color).attr("fill-opacity",b.circle_opacity_cb||1).on("click",b.click_cb).on("mouseover",function(a){d3.select(this).transition().duration(50).attr("r",b.circle_over_radius).attr("fill",b.circle_color2).attr("fill-opacity",1)}).on("mouseout",function(a){d3.select(this).transition().duration(50).attr("r",b.circle_radius).attr("fill",b.circle_color).attr("fill-opacity",b.circle_opacity_cb||1)}).append("svg:title").text(b.title_cb),m=d3.time.scale().domain([new Date(e),new Date(f)]).range(h),l.append("g").attr("transform","translate(0,"+(20+b.lane_height*j.length)+")").attr("class","axis").call(d3.svg.axis().scale(m).orient("bottom").ticks(b.ticks).innerTickSize(5).outerTickSize(1)).style("fill",b.circle_color).style("stroke","none"),!b.hide_types){var p=l.append("text").attr("x",5).attr("y",12).text("Type /");p.on("click",function(){a._sort_type="t",a.redraw()}),p.style("cursor","pointer");var q=l.append("text").attr("x",32).attr("y",12).text("Date /");q.on("click",function(){a._sort_type="d",a.redraw()}),q.style("cursor","pointer");var r=l.append("text").attr("x",62).attr("y",12).text("Count");r.on("click",function(){a._sort_type="c",a.redraw()}),r.style("cursor","pointer")}};var TsDashboard=TsDashboard||{};TsDashboard.Widgets=TsDashboard.Widgets||{},TsDashboard.Widgets.TimeSeries=function(a){this.sufix=""+Math.floor(1e6*Math.random());var b={chart_div:"#someChart",data:null,bands:null,height:100,xaccessor:function(a){return null==a?null:a.epoch},yaccessor:function(a){return null==a?null:a.val},xdomain:null,xdomain_min:null,xdomain_max:null,ydomain:null,ydomain_min:null,ydomain_max:null,series_style_indices:null,handle_clicks:!1,show_grid:!0,x_axis_label:null,y_axis_label:null,xAxisFontSize:"14px",yAxisFontSize:"14px",xAxisTicks:7,yFormatValue:".2s",yAxisTicks:null,tickNumber:function(a,b){return Math.min(a<100?3:8,b)},markerStroke:3,markerOpacity:.4,markerOpacityHover:.8,markerColor:"#ff0000",click_callback:null,timepoints:null,margin_top:18,margin_right:35,margin_bottom:20,margin_left:50,labels:null,backgroundSegments:null,backgroundSegmentAxis:"x",backgroundSegmentOpacity:.3,exportable:!1};if("undefined"!==a)for(var c in a)b[c]=a[c];this._p=b},TsDashboard.Widgets.TimeSeries.prototype.draw=function(){var a=this._p,b=this;if(!a.xdomain){var c=a.data.map(function(b){return d3.extent(b,a.xaccessor)}),d=[];c.forEach(function(a){d=d.concat(a)}),a.xdomain=d3.extent(d)}if(!a.ydomain){var c=a.data.map(function(b){return d3.extent(b,a.yaccessor)}),d=[];c.forEach(function(a){d=d.concat(a)}),a.ydomain=d3.extent(d)}null!==a.xdomain_min&&(a.xdomain[0]=a.xdomain_min),null!==a.xdomain_max&&(a.xdomain[1]=a.xdomain_max),null!==a.ydomain_min&&(a.ydomain[0]=a.ydomain_min),null!==a.ydomain_max&&(a.ydomain[1]=a.ydomain_max);var e=0;if(a.data.forEach(function(a){e+=a.length}),!a.series_style_indices){a.series_style_indices=[];for(var f=0;f<a.data.length;f++)a.series_style_indices.push(f)}$(a.chart_div).empty();var h={top:a.margin_top,right:a.margin_right,bottom:a.margin_bottom,left:a.margin_left};a.x_axis_label&&(h.bottom+=20);var i=$(a.chart_div).width()-h.left-h.right,j=a.height-h.top-h.bottom,k=(d3.time.format("%d-%b-%y").parse,d3.time.scale().domain(a.xdomain).range([0,i])),l=d3.scale.linear().domain(a.ydomain).range([j,0]),m=(k.domain()[1].getTime(),k.domain()[0].getTime(),d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],["%d %b",function(a){return a.getDay()&&1!=a.getDate()}],["%d %b",function(a){return 1!=a.getDate()}],["%d %b",function(a){return a.getMonth()}],["%d %b %Y",function(){return!0}]])),n=d3.svg.axis().scale(k).orient("bottom").ticks(a.xAxisTicks).tickFormat(m);a.show_grid&&n.innerTickSize(-j).outerTickSize(0).tickPadding(10);var o=d3.format(a.yFormatValue),p=a.tickNumber(j,a.ydomain[1]);null!=a.yAxisTicks&&(p=a.yAxisTicks);for(var q=[],f=1;f<=p;f++)q.push(a.ydomain[0]+f*(a.ydomain[1]-a.ydomain[0])/(p+1));var r=d3.svg.axis().scale(l).tickValues(q).tickFormat(function(a){return o(a)}).orient("left");a.show_grid&&r.innerTickSize(-i).outerTickSize(0).tickPadding(10);var s=d3.svg.line().x(function(b){return k(a.xaccessor(b))}).y(function(b){return l(a.yaccessor(b))}),t=d3.svg.area().x(function(b){return k(a.xaccessor(b))}).y0(function(a){return l(a.val0)}).y1(function(a){return l(a.val1)}),u="TimeSeriesInnerDiv"+b.sufix,v=d3.select(a.chart_div).append("div").attr("id",u).attr("style","position: relative"),w=v.append("div").attr("style","position: relative").append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),x=[];if(a.bands)for(var f=0;f<a.bands.length;f++){var y=[],z=a.data[a.bands[f].ref],A=a.data[a.bands[f].lower],B=a.data[a.bands[f].upper];a.series_style_indices[a.bands[f].ref];x.push(a.bands[f].lower),x.push(a.bands[f].upper);for(var C=0;C<A.length;C++)y.push({val0:A[C].val,val1:B[C].val,epoch:A[C].epoch});w.append("path").style("fill","white").style("fill-opacity",.25).style("stroke","none").attr("d",t(y))}for(var f=0;f<a.data.length;f++)if(-1==x.indexOf(f)){var z=a.data[f];w.append("path").attr("class","series series"+a.series_style_indices[f]).attr("d",s(z))}w.append("g").attr("class","x axis").attr("transform","translate(0, "+j+")").style("font-size",a.xAxisFontSize).call(n),g=w.append("g").attr("class","y axis").style("font-size",a.yAxisFontSize).call(r),null!=a.x_axis_label&&w.append("text").attr("class","x label").attr("text-anchor","end").attr("x",i-10).attr("y",j+h.top+16).text(a.x_axis_label),null!=a.y_axis_label&&w.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text(a.y_axis_label);var D=v.append("div").attr("class","line-chart-tooltip").attr("id",a.chart_div+"_tooltip").style("opacity",0);if(a.handle_clicks){var E=function(b){for(var c=d3.mouse(b),d=k.invert(c[0]),e=l.invert(c[1]),f=null,g=null,h=0;h<a.data.length;h++){var i,j=d3.bisector(a.xaccessor).left,m=j(a.data[h],d),n=a.data[h][m];i=0==m||1==a.data[h].length||m>=a.data[h].length?n:a.data[h][m-1];var o,p;null!=i&&(o=a.xaccessor(i)),null!=n&&(p=a.xaccessor(n));var q=d.getTime()-o>p-d.getTime()?n:i,r=a.yaccessor(q);(!g||Math.abs(g-e)>Math.abs(r-e))&&(g=r,f=q)}return f};g.on("click",function(){if(a.click_callback){var b=E(this);a.click_callback(b.epoch)}});var F=g.append("g").style("display","none");F.append("line").attr("id","focusLineX"+b.sufix).attr("class","focusLine").style("stroke-dasharray","5, 3"),F.append("line").attr("id","focusLineY"+b.sufix).attr("class","focusLine").style("stroke-dasharray","5, 3"),F.append("circle").attr("id","focusCircle"+b.sufix).attr("r",5).attr("class","circle focusCircle"),g.append("rect").attr("class","overlay").attr("width",i).attr("height",j).on("mouseover",function(){F.style("display",null)}).on("mouseout",function(){F.style("display","none"),D.style("opacity",0)}).on("mousemove",function(){var c=E(this);if(null!=c){var d=k(new Date(a.xaccessor(c))),e=l(a.yaccessor(c));F.style("display",null),D.style("opacity",.8),D.html(a.yaccessor(c).toFixed(4)+"<br/>"+b.getTimeString(a.xaccessor(c))).style("left",d-10+"px").style("top",e+40+"px"),F.select("#focusCircle"+b.sufix).attr("cx",d).attr("cy",e),F.select("#focusLineX"+b.sufix).attr("x1",d).attr("y1",l(l.domain()[0])).attr("x2",d).attr("y2",l(l.domain()[1])),F.select("#focusLineY"+b.sufix).attr("x1",k(k.domain()[0])).attr("y1",e).attr("x2",k(k.domain()[1])).attr("y2",e)}})}if(a.backgroundSegments)for(var G=0;G<a.backgroundSegments.length;G++){var H=a.backgroundSegments[G],I=H.epoch_start,J=H.epoch_end,K=H.color;if(void 0!=I&&void 0!=J&&void 0!=K)if("x"==a.backgroundSegmentAxis){var L=Math.max(k(I),0);w.append("rect").attr("x",L).attr("y",0).attr("width",k(J)-L).attr("height",a.height-h.top-h.bottom).style("fill",K).style("fill-opacity",a.backgroundSegmentOpacity)}else{var M=Math.max(l(J),0),N=l(I)-M;w.append("rect").attr("x",0).attr("y",M).attr("width",i).attr("height",N).style("fill",K).style("fill-opacity",a.backgroundSegmentOpacity)}}if(a.timepoints&&a.timepoints.length>0)for(var C=0;C<a.timepoints.length;C++)for(var O=a.timepoints[C],f=0;f<O.length;f++){var P=O[f],Q=P.title,R=P.epoch,S=b.getTimeString(P.epoch),T=k(R),U=a.markerColor;!isNaN(T)&&T>0&&w.append("a").append("line").attr("id",T).attr("data:ts",S).attr("data:tt-title",Q).attr("x1",T).attr("x2",T).attr("y1",0).attr("y2",a.height-h.top-h.bottom).style("stroke",U).style("stroke-width",a.markerStroke).style("opacity",a.markerOpacity).on("mouseover",function(b){var c=d3.select(this)[0][0].id,d=d3.select(this)[0][0].attributes[1].value,e=d3.select(this)[0][0].attributes[2].value;d3.select(this).style("opacity",.6),D.style("opacity",a.markerOpacityHover),D.html(e+"<br/>"+d).style("left",c-70+"px").style("bottom",j+"px")}).on("mouseout",function(b){d3.select(this).style("opacity",a.markerOpacity),D.style("opacity",0)})}e<=0&&g.append("text").attr("x",i/2).attr("y",j/2).attr("dy","1em").attr("text-anchor","end").text("NO DATA!").attr("class","zerolinetext");var V=20,W=20;if(a.labels){for(var f=0;f<a.labels.length;f++)if(a.labels[f]){var X=8*a.labels[f].length;g.append("rect").attr("x",V).attr("y",W-10).attr("width",10).attr("height",10).attr("class","series-legend"+f),g.append("text").attr("x",V+12).attr("y",W).text(a.labels[f]),V+2*X>i?(V=20,W+=20):V+=X+10}}else{a.labels=[];for(var f=0;f<a.data.length;f++)a.labels.push("Series"+f)}if(a.exportable){var Y=$("<div></div>");Y.addClass("btn-export-data"),Y.css("position","absolute"),Y.css("right",h.right),Y.css("top",h.top),Y.click(function(){var c="",d=a.data;if(0==d.length)return void b.promptDownload("export.csv",c);c+="timestamp";for(var e=0;e<d.length;e++)c+=","+a.labels[e];for(var f=(d[0].length,{}),e=0;e<d.length;e++)for(var g=0;g<d[e].length;g++){var h=d[e][g].epoch,i=d[e][g].val;if(h in f)f[h][e]=i;else{f[h]=[];for(var j=0;j<d.length;j++)f[h].push(0)}}for(var e=0;e<d.length;e++)for(var g=0;g<d[e].length;g++){var h=d[e][g].epoch,i=d[e][g].val;h in f&&(f[h][e]=i)}var k=[];for(var h in f)k.push(h);k.sort();for(var l=0;l<k.length;l++){var m="\n";m+=k[l].toString();for(var n=0;n<d.length;n++)m+=","+f[k[l]][n].toString();c+=m}b.promptDownload("export.csv",c)}),$("#"+u).append(Y)}},TsDashboard.Widgets.TimeSeries.prototype.getTimeString=function(a){return a||(a=new Date),moment(a).format("YYYY-MM-DD hh:mm:ss")},TsDashboard.Widgets.TimeSeries.prototype.promptDownload=function(a,b){var c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(b)),c.setAttribute("download",a),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},TsDashboard=TsDashboard||{},TsDashboard.Widgets=TsDashboard.Widgets||{},TsDashboard.Widgets.getDateTimeString=function(a){return a||(a=new Date),moment(a).format("YYYY-MM-DD hh:mm:ss")},TsDashboard.Widgets.SparklineTable=function(a){var b={target_div:"#someChart",data:null,spark_height:15,columns:3,col_names:null,first_col_width:150};if("undefined"!==a)for(var c in a)b[c]=a[c];if(null==b.col_names){b.col_names=[];for(var d=0;d<b.columns;d++)b.col_names.push("")}b.target_div.startsWith("#")||(b.target_div="#"+b.target_div),this._p=b,this._sort_type="d",this.clear()},TsDashboard.Widgets.SparklineTable.prototype.clear=function(a){},TsDashboard.Widgets.SparklineTable.prototype.redraw=function(a){this.clear(),this.draw()},TsDashboard.Widgets.SparklineTable.prototype.draw=function(){var a=this._p,b=d3.svg.line().interpolate("linear").x(function(a){return w(a.epoch)}).y(function(a){return x(a.val)}),c=d3.svg.area().x(function(a){return w(a.epoch)}).y0(function(a){return x(a.val)}).y1(function(a){return x(0)});$(a.target_div).empty();for(var d=a.data,e=a.columns,f=Math.floor((a.data.length-1)/e)+1,g=$("<thead></thead>"),h=$("<tr></tr>"),i=0;i<a.col_names.length;i++){var j=0==i?" style='white-space:nowrap' ":"";h.append("<th"+j+">"+a.col_names[i]+"</th>")}g.append(h);var k=$("<tbody></tbody>"),l=$('<table class="table"></table>');l.append(g),l.append(k),$(a.target_div).append(l),$(a.target_div).css("overflow","auto"),$(a.target_div).css("height",a.height),$(a.target_div).css("margin-bottom",a.margin_bottom);var m=((l.width()-a.first_col_width)/e).toFixed();console.log("col_width",m);for(var i=0;i<=f;i++){var n=$("<tr></tr>");k.append(n);for(var o=0;o<e;o++){var p=i*e+o;if(!(p>=a.data.length)){var q=d[p].values,r=d[p].title;if(0==o){var s=r,t=$("<td style='background-color:black !important; width:"+a.first_col_width+"px; word-break:break-all;'>"+s+"</td>");n.append(t)}var u=$("<td style='background-color:black !important; border-left: thin solid #282828; width:"+m+"px;'></td>"),v=document.createElement("div");u.append(v),n.append(u),q.forEach(function(a){a.date=TsDashboard.Widgets.getDateTimeString(a.epoch)});var w=d3.time.scale().domain([d3.min(q,function(a){return a.epoch}),d3.max(q,function(a){return a.epoch})]).range([0,+m]),x=d3.scale.linear().domain([d3.min(q,function(a){return a.val}),d3.max(q,function(a){return a.val})]).range([a.spark_height,0]),y=d3.select(v).append("svg").attr("width",+m).attr("height",a.spark_height);y.append("path").attr("d",b(q)).attr("stroke","#147BB1").style("stroke-width",1),y.append("path").style("fill","#147BB1").style("fill-opacity",.8).style("stroke","none").attr("fill","#147BB1").attr("d",c(q))}}}};