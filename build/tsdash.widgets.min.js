/*! tsdash 2017-08-11 */

function WidgetSwimLanes(a){var b={start:null,end:null,events:null,categories:null,side_margin:0,chart_div:"#divTarget",circle_color:"#007ACC",circle_color2:"#72afcc",lanes_color:"#333",master_lane_color:"#333",lane_opacity:1,lane_selected_opacity:1,lane_height:30,circle_radius:8,circle_over_radius:10,ticks:10,show_now:!1,start_hover_callback:function(){},end_hover_callback:function(){}};if("undefined"!==a)for(var c in a)b[c]=a[c];this._p=b,this._eventTypes=[],this._eventTypesDict={},this.analyzeEventTypes()}WidgetSwimLanes.prototype.getTimeString=function(a){return a||(a=new Date),moment(a).format("YYYY-MM-DD hh:mm:ss")},WidgetSwimLanes.prototype.getEventType=function(a){for(var b=this._p,c="",d=0;d<b.categories.length;d++){c+="["+a[b.categories[d]]+"] "}return c.trim()},WidgetSwimLanes.prototype.analyzeEventTypes=function(){for(var a=(this._p,this._p.events),b=this._eventTypes,c=this._eventTypesDict,d=0;d<a.length;d++){var e=a[d],f=this.getEventType(e);if(f in c){var g=c[f];b[g].max=e.ts,b[g].cnt++}else c[f]=b.length,b.push({type:f,min:e.ts,max:e.ts,cnt:1})}b.sort(function(a,b){return a.type.localeCompare(b.type)});for(var d=0;d<b.length;d++)c[b[d].type]=d},WidgetSwimLanes.prototype.draw=function(){var a=this,b=this._p,c=$(b.chart_div).width(),d=b.events,e=b.start||d[0].ts,f=b.end||d[d.length-1].ts,g=f-e;e-=.05*g,f+=.05*g,$(b.chart_div).empty().css("padding",b.side_margin).css("font-size",10).css("background-color",b.lanes_color);var h=[2*b.side_margin,c-2*b.side_margin],i=d3.scale.linear().domain([e,f]).range(h),j=this._eventTypes,k=this._eventTypesDict,l=d3.select(b.chart_div).append("svg").attr("width",c).attr("height",b.lane_height*j.length+40),m=d3.time.scale().domain([new Date(e),new Date(f)]).range(h);l.append("g").attr("transform","translate(0,20)").attr("class","axis").call(d3.svg.axis().scale(m).orient("top").ticks(b.ticks).innerTickSize(5).outerTickSize(1)).style("fill",b.circle_color).style("stroke","none");var n=l.append("g").selectAll(".timeline-lane").data(j).enter().append("g").attr("transform",function(a,c){return"translate(0,"+(20+c*b.lane_height)+")"});n.append("rect").attr("class","timeline-lane").attr("x",0).attr("y",0).attr("width",c).attr("height",b.lane_height).on("click",function(a,b){}),n.append("text").attr("class","timeline-lane-title").attr("x",5).attr("dy","1.5em").text(function(a,b){return a.type||""}),l.append("g").selectAll("line").data(j).enter().append("line").attr("x1",function(a){return i(a.min)}).attr("y1",function(a,c){return 20+(.5+c)*b.lane_height}).attr("x2",function(a){return i(a.max)}).attr("y2",function(a,c){return 20+(.5+c)*b.lane_height}).style("stroke",b.circle_color).style("stroke-width",1),l.selectAll("circle").data(d).enter().append("circle").attr("cy",function(c){return 20+(.5+k[a.getEventType(c)])*b.lane_height}).attr("cx",function(a){return i(a.ts)}).attr("r",b.circle_radius).attr("fill",b.circle_color).on("mouseover",function(a){d3.select(this).transition().duration(100).attr("r",b.circle_over_radius).attr("fill",b.circle_color2)}).on("mouseout",function(a){d3.select(this).transition().duration(100).attr("r",b.circle_radius).attr("fill",b.circle_color)}).append("svg:title").text(function(b){return a.getTimeString(b.ts)}),m=d3.time.scale().domain([new Date(e),new Date(f)]).range(h),l.append("g").attr("transform","translate(0,"+(20+b.lane_height*j.length)+")").attr("class","axis").call(d3.svg.axis().scale(m).orient("bottom").ticks(b.ticks).innerTickSize(5).outerTickSize(1)).style("fill",b.circle_color).style("stroke","none")};