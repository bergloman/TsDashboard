<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../../dep/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../../src/tsdash.css">
    <style>
        input {
            width: 100%;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <h2> Test for swimlane widget</h2>
                <div class="form-group row">
                    <label for="example-text-input" class="col-4 col-form-label">From</label>
                    <div class="col-8">
                        <input class="form-control" type="text" value="2017-07-05 07:00:00" id="inFrom">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="example-text-input" class="col-4 col-form-label">To</label>
                    <div class="col-8">
                        <input class="form-control" type="text" value="2017-07-05 08:00:00" id="inTo">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="example-text-input" class="col-4 col-form-label">Server</label>
                    <div class="col-8">
                        <input class="form-control" type="text" value="" id="inServer">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="example-text-input" class="col-4 col-form-label">Service</label>
                    <div class="col-8">
                        <input class="form-control" type="text" value="" id="inService">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="example-text-input" class="col-4 col-form-label">Field</label>
                    <div class="col-8">
                        <input class="form-control" type="text" value="" id="inField">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="example-text-input" class="col-4 col-form-label">Show Server</label>
                    <div class="col-8">
                        <input checked="true" class="form-control" type="checkbox" value="" id="inCServer">
                    </div>
                    <label for="example-text-input" class="col-4 col-form-label">Show Service</label>
                    <div class="col-8">
                        <input checked="true" class="form-control" type="checkbox" value="" id="inCService">
                    </div>
                    <label for="example-text-input" class="col-4 col-form-label">Show Field</label>
                    <div class="col-8">
                        <input checked="true" class="form-control" type="checkbox" value="" id="inCField">
                    </div>
                </div>
                <div class="form-group row">
                    <button id="btnShow" class="btn btn-primary">Show</button>
                </div>
            </div>
            <div class="col-md-9">
                <div id="divTarget"></div>
            </div>
        </div>
    </div>

    <!--<script src="dep/d3-4.1.1.min.js"></script>-->
    <script src="../../dep/d3.js"></script>
    <script src="../../dep/moment.min.js"></script>
    <script src="../../dep/jquery-3.1.0.min.js"></script>
    <script src="../../dep/bootstrap.min.js"></script>
    <script src="../../../src/widgets/tsdash-swimlanes.js"></script>
    <script src="out.js"></script>

    <script>
        // prepare data
        $(function () {
            var categories = ["server", "service_name", "field"];

            var calculateEventType = function (x) {
                return categories
                    .map(function (y) { return "[" + x[y] + "]"; })
                    .join("");
            };

            wpData.forEach(function (x) {
                x.ts = Date.parse(x.ts);
                x.type = calculateEventType(x);
            });
            var events = wpData.slice(2101, 3500);
            var options = {
                start: events[0].ts,
                end: events[events.length - 1].ts,
                events: events,
                categories: ["server", "service_name", "field"],
                chart_div: "divTarget",
                circle_radius: 4,
                left_padding: 160,
                circle_color_cb: function (d) {
                    return (Math.random() > 0.7 ? "red" : "blue")
                },
                title_cb: function (d) {
                    return d.service_name + "[" + d.field + "] " + "\n" +
                        d.server + "\n" +
                        WidgetSwimLanes.prototype.getTimeString(d.ts);
                },
                click_cb: function (d) {
                    alert(d.server)
                },
                circle_opacity_cb: 0.2 || function (d) {
                    //return (Math.random() > 0.7 ? 1 : 0.2);
                    return 0.2
                },
                circle_radius_cb: function (d) {
                    return 4;
                }
            };

            var widget = new WidgetSwimLanes(options);
            widget.draw();

            $("#btnShow").click(function () {
                let sfrom = $("#inFrom").val();
                let from = Date.parse(sfrom);
                let sto = $("#inTo").val();
                let to = Date.parse(sto);
                let server = $("#inServer").val();
                let service = $("#inService").val();
                let field = $("#inField").val();

                categories = [];
                if ($("#inCServer:checked").length > 0) categories.push("server");
                if ($("#inCService:checked").length > 0) categories.push("service_name");
                if ($("#inCField:checked").length > 0) categories.push("field");

                options.events = wpData.filter(function (x) {
                    if (x.ts < from || x.ts > to) return false;
                    if (server && server.length > 0 && x.server.indexOf(server) < 0) return false;
                    if (service && service.length > 0 && x.service_name.indexOf(service) < 0) return false;
                    if (field && field.length > 0 && x.field.indexOf(field) < 0) return false;
                    x.type = calculateEventType(x);
                    return true;
                });
                options.start = from;
                options.end = to;
                var widget = new WidgetSwimLanes(options);
                widget.draw();
            });
        });
    </script>
</body>

</html>
